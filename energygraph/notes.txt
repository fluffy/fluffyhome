# some simple notes no how to install and 



sudo apt-get install python-dev
sudo apt-get install build-essential tcsh

apt-get install postgresql python-psycopg2

apt-get install rabbitmq-server
sudo pip install django-celery


install postgres, create user, create DB 
su postgres
createuser -S -D -R fluffy
createdb energygraph 

You can muck with DB with 
psql -d energygraph -U fluffy -h localhost
SELECT "userID", "userName", "passwd" FROM store_user ORDER BY "userID" ;
SELECT "sensorID", "userID", "sensorName" FROM store_sensor ORDER BY "sensorID";
can fix up passwords with
UPDATE store_user SET "passwd" = 'newpwd'  WHERE "userID" = 5 ;
right now am using django auth passwords on one in this DB so that does not
matter 

ECM1240-5723-aux5 for user 3 (plagd)   is sensorID 115 
ECM1240-42340-ch2 for user 1 cullen is sensorid 40 

mongo 
use energygraph
show collections
db.measurements1.find( { sensorID: 40 } , { time: true, value: true  }  ).sort({ time: -11 } ).limit(5)
db.measurements1.find( { sensorID: 115 } , { time: true, value: true,integral:true   }  ).sort( { time: -1 } ).limit(10)






manage.py syncdb

set up the database password in settings


sudo apt-get redis-server
sudo pip install redis


cd  /etc/apache2/sites-availab
sudo ln -s /home/fluffy/src/fluffyhome/energygraph/apache.conf fluffyhome
cd ../sites-enabled
sudo ln -s ../sites-available/fluffyhome

sudo apache2ctl restart


can monitors task in celery with a web server started with 
celery flower --broker=redis://localhost:6379/0


Set up following environment variables

setenv DATABASE_URL postgres://fluffy:pwd@localhost/hero
setenv DJANGO_SECRET_KEY junkhere

setenv REDISTOGO_URL redis://localhost:6379

setenv DJANGO_DEBUG TRUE

setenv AWS_ACCESS_KEY_ID "foobar"
setenv AWS_SECRET_ACCESS_KEY "barfoo"

../manage.py syncdb


On my local devel mac, for the celry cron jobs use 
../manage.py celery worker --loglevel=info -E -B

and run main program with 
../manage.py runserver


 sudo pip install celery celery-with-redis flower pytz django-celery


sudo apt-get install supervisor
cd /etc/supervisor/conf.d
sudo ln -s /home/fluffy/src/fluffyhome/energygraph/supervisor-celery.conf 
sudo mkdir /var/lib/celery
sudo chmod a+rw /var/lib/celery

sudo supervisorctl reload ; sudo supervisorctl restart celery



pip install fabric 
set up sudoeers file with visudo 
fluffy ALL = NOPASSWD: ALL



You can now deploy with 
fab deploy
